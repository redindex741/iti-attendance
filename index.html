<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ITI Attendance System</title>
  <!-- Firebase SDK config -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getAuth } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";
    const firebaseConfig = {
      apiKey: "AIzaSyDaN_xsPxCkqtLsQwUjNBztEEU9RQ4B9mA",
      authDomain: "iti-a-75307.firebaseapp.com",
      projectId: "iti-a-75307",
      storageBucket: "iti-a-75307.appspot.com",
      messagingSenderId: "415777152029",
      appId: "1:415777152029:web:2e3f880a27be750d627af4"
    };
    const app = initializeApp(firebaseConfig);
    window.firebaseAuth = getAuth(app);
    window.firebaseDb = getFirestore(app);
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.28/dist/jspdf.plugin.autotable.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }
    .navbar {
      background: linear-gradient(90deg, #2c3e50, #3498db);
      color: white;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    .navbar h1 {
      font-size: 24px; font-weight: 600;
    }
    .container { max-width: 1200px; margin: 20px auto; padding: 20px; }
    .control-panel {
      background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    .control-panel h2 { color: #2c3e50; margin-bottom: 15px; text-align: center; }
    .button-group { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
    #attendanceSection {
      background: white; padding: 25px; border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    #attendanceSection h2 { color: #2c3e50; text-align: center; margin-bottom: 20px; }
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #555; }
    select, input {
      width: 100%; padding: 10px; border: 2px solid #ddd;
      border-radius: 5px; font-size: 16px; transition: border-color 0.3s;
    }
    select:focus, input:focus { outline: none; border-color: #3498db; }
    #studentsList { list-style: none; padding: 0; max-height: 400px; overflow-y: auto; }
    .student-item {
      display: flex; justify-content: space-between; align-items: center;
      padding: 15px; margin: 10px 0; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #3498db; transition: all 0.3s ease;
    }
    .student-info { flex-grow: 1; }
    .student-name { font-weight: 600; font-size: 16px; color: #2c3e50; }
    .student-details { font-size: 14px; color: #666; margin-top: 2px; }
    .attendance-buttons { display: flex; gap: 8px; }
    .attendance-btn { padding: 8px 15px; border: none; border-radius: 20px; cursor: pointer; font-weight: 600; text-transform: uppercase; font-size: 12px; transition: all 0.3s ease; min-width: 60px; }
    .btn-present { background: #2ecc71; color: white; }
    .btn-present:hover { background: #27ae60; transform: translateY(-2px); }
    .btn-absent { background: #e74c3c; color: white; }
    .btn-absent:hover { background: #c0392b; transform: translateY(-2px); }
    .btn-leave { background: #f39c12; color: white; }
    .btn-leave:hover { background: #d68910; transform: translateY(-2px); }
    .student-item.present { background: linear-gradient(90deg, #d5f4e6, #f0f9ff); border-left-color: #2ecc71; }
    .student-item.absent { background: linear-gradient(90deg, #fdeaea, #fff5f5); border-left-color: #e74c3c; }
    .student-item.leave { background: linear-gradient(90deg, #fef9e7, #fffef7); border-left-color: #f39c12; }
    #summarySection { margin: 20px 0; padding: 20px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 10px; color: white; }
    #summarySection h3 { text-align: center; margin-bottom: 15px; }
    .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
    .summary-card { background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px; text-align: center; backdrop-filter: blur(10px); }
    .summary-label { display: block; font-size: 14px; margin-bottom: 5px; opacity: 0.9; }
    .summary-value { font-size: 24px; font-weight: 700; }
    button { background: linear-gradient(45deg, #667eea, #764ba2); color: white; border: none; padding: 12px 20px; border-radius: 25px; cursor: pointer; font-size: 16px; font-weight: 600; transition: all 0.3s ease; }
    button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
    #submitAttendance { width: 100%; padding: 15px; font-size: 18px; margin-top: 20px; background: linear-gradient(45deg, #11998e, #38ef7d); }
    .popup { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; backdrop-filter: blur(5px); }
    .popup-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.3); min-width: 400px; }
    .popup-content h2 { text-align: center; color: #2c3e50; margin-bottom: 20px; }
    /* Responsive Design */
    @media (max-width: 768px) {
      .navbar { flex-direction: column; text-align: center; }
      .button-group { flex-direction: column; }
      .student-item { flex-direction: column; gap: 10px; }
      .attendance-buttons { justify-content: center; }
      .popup-content { min-width: 90%; margin: 0 20px; }
      .summary-grid { grid-template-columns: repeat(2, 1fr); }
    }
    .loading { display: inline-block; width: 20px; height: 20px; border: 3px solid #f3f3f3; border-top: 3px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .success-message { background: #d4edda; color: #155724; padding: 10px 15px; border-radius: 5px; margin: 10px 0; border-left: 4px solid #28a745; }
    .error-message { background: #f8d7da; color: #721c24; padding: 10px 15px; border-radius: 5px; margin: 10px 0; border-left: 4px solid #dc3545; }
  </style>
</head>
<body>
  <div id="loginContainer" style="display: flex; flex-direction: column; width: 300px; margin: 50px auto;">
    <h2>Login</h2>
    <input id="email" placeholder="Email" />
    <input id="password" type="password" placeholder="Password" />
    <button id="loginBtn">Login</button>
    <div id="loginError" class="error-message" style="display: none;">Invalid credentials</div>
  </div>
  <div class="navbar" style="display:none;">
    <div>ITI Attendance System</div>
    <div>
      Date: <span id="currentDate"></span>
      <button id="logoutBtn">Logout</button>
    </div>
  </div>
  <div class="container" style="display:none;">
    <div class="control-panel">
      <h2>Controls</h2>
      <div class="button-group">
        <button onclick="showAddTradeForm()">Add Trade</button>
        <button onclick="showAddStudentForm()">Add Student</button>
        <button onclick="toggleReports()">View Records</button>
        <button onclick="showRemoveTradeForm()">Remove Trade</button>
      </div>
    </div>
    <div id="attendanceSection">
      <div class="form-group">
        <label for="tradeSelector">Select Trade:</label>
        <select id="tradeSelector" onchange="showStudentsList()"><option value="">-- Select Trade --</option></select>
      </div>
      <ul id="studentsList"></ul>
      <div id="summarySection">
        <h3>Daily Summary</h3>
        <div class="summary-grid">
          <div class="summary-card"><span class="summary-label">Total Students</span><span class="summary-value" id="totalStudents">0</span></div>
          <div class="summary-card"><span class="summary-label">Present</span><span class="summary-value" id="totalPresent">0</span></div>
          <div class="summary-card"><span class="summary-label">Absent</span><span class="summary-value" id="totalAbsent">0</span></div>
          <div class="summary-card"><span class="summary-label">On Leave</span><span class="summary-value" id="totalLeave">0</span></div>
        </div>
      </div>
      <button id="submitAttendance" onclick="submitAttendance()">Submit Daily Attendance</button>
    </div>
    <div id="recordsSection" style="margin-top:30px; display:none;">
      <h4>View Records</h4>
      <label for="recordsTradeSelector">Trade:</label>
      <select id="recordsTradeSelector"><option value="">All Trades</option></select>
      <label for="recordsDateSelector">Date:</label>
      <input type="date" id="recordsDateSelector" />
      <button onclick="showRecords()">Show Records</button>
      <div id="recordsTable" style="margin-top: 15px;"></div>
      <div style="margin-top: 15px;">
        <button onclick="downloadPdf('present')">Download Present PDF</button>
        <button onclick="downloadPdf('absent')">Download Absent PDF</button>
        <button onclick="downloadPdf('leave')">Download Leave PDF</button>
      </div>
    </div>
  </div>
  <!-- Popups -->
  <div id="addTradePopup" class="popup">
    <div class="popup-content">
      <h2>Add Trade</h2>
      <input type="text" id="newTradeName" placeholder="Trade Name" /><br /><br />
      <input type="text" id="newTradeCode" placeholder="Trade Code (e.g., COP, ELE)" /><br /><br />
      <button onclick="addTrade()">Add Trade</button>
      <button onclick="closePopup()">Cancel</button>
    </div>
  </div>
  <div id="addStudentPopup" class="popup">
    <div class="popup-content">
      <h2>Add Student</h2>
      <label for="studentTrade">Trade:</label><br />
      <select id="studentTrade"><option value="">--Select Trade--</option></select><br /><br />
      <input type="text" id="newStudentName" placeholder="Full Name" /><br /><br />
      <label for="newStudentYear">Year:</label>
      <select id="newStudentYear"><option value="1">1</option><option value="2">2</option></select><br /><br />
      <input type="text" id="newStudentMobile" placeholder="Mobile Number" /><br /><br />
      <label for="newStudentAdmission">Admission Date:</label>
      <input type="date" id="newStudentAdmission" /><br /><br />
      <input type="number" id="newStudentShift" placeholder="Shift Number (e.g., 1,2)" /><br /><br />
      <input type="text" id="newStudentUnit" placeholder="Unit (e.g., 1A, 2B)" /><br /><br />
      <button onclick="addStudent()">Add</button>
      <button onclick="closePopup()">Cancel</button>
    </div>
  </div>
  <div id="removeTradePopup" class="popup">
    <div class="popup-content">
      <h2>Remove Trade</h2>
      <select id="removeTradeSelector"></select><br /><br />
      <button onclick="removeTrade()">Remove</button>
      <button onclick="closePopup()">Cancel</button>
    </div>
  </div>
  <!-- Main JS -->
  <script type="module">
    import { signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
    import { collection, doc, setDoc, getDoc, getDocs, updateDoc, deleteDoc, query, where } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

    const auth = window.firebaseAuth;
    const db = window.firebaseDb;
    const loginContainer = document.getElementById('loginContainer');
    const loginBtn = document.getElementById('loginBtn');
    const loginError = document.getElementById('loginError');
    const appContainer = document.querySelector('.container');
    const logoutBtn = document.getElementById('logoutBtn');

    function toIsoDate(dateStr) { if (/^\d{4}-\d{2}-\d{2}$/.test(dateStr)) return dateStr;
      const parts = dateStr.split('/'); if (parts.length === 3) {
      const m = parts[0].padStart(2, '0'); const d = parts[1].padStart(2, '0'); const y = parts[2];
      return `${y}-${m}-${d}`; } return dateStr; }
    function getToday() { const now = new Date(); const offsetMs = 5.5 * 60 * 60 * 1000;
      const local = new Date(now.getTime() + offsetMs); return local.toISOString().slice(0, 10); }
    window.showAddTradeForm = function() { document.getElementById('addTradePopup').style.display = 'flex'; };
    window.showAddStudentForm = function() { document.getElementById('addStudentPopup').style.display = 'flex'; };
    window.closePopup = function() {
      document.getElementById('addTradePopup').style.display = 'none';
      document.getElementById('addStudentPopup').style.display = 'none';
      document.getElementById('removeTradePopup').style.display = 'none'; };
    window.toggleReports = function() {
      const recSec = document.getElementById('recordsSection');
      recSec.style.display = recSec.style.display === 'block' ? 'none' : 'block';
    };
    window.showRemoveTradeForm = async function() {
      document.getElementById('removeTradePopup').style.display = 'flex';
      const select = document.getElementById('removeTradeSelector');
      select.innerHTML = '<option value="">Choose Trade</option>';
      const tradesSnapshot = await getDocs(collection(db, 'trades'));
      tradesSnapshot.forEach(docSnap => {
        const trade = docSnap.data();
        const opt = document.createElement("option");
        opt.value = docSnap.id; opt.textContent = `${trade.name} (${trade.code})`;
        select.appendChild(opt); });
    };
    window.removeTrade = async function() {
      const tradeCode = document.getElementById('removeTradeSelector').value;
      if (!tradeCode) return alert('Please select a trade to remove.');
      if (!confirm("Are you sure you want to delete this trade and ALL students/attendance for it?")) return;
      await deleteDoc(doc(db, "trades", tradeCode));
      const studentsQuery = query(collection(db, "students"), where("tradeCode", "==", tradeCode));
      const studentsSnapshot = await getDocs(studentsQuery);
      for (const studentDoc of studentsSnapshot.docs) { await deleteDoc(doc(db, "students", studentDoc.id)); }
      const attendanceSnapshot = await getDocs(collection(db, "attendance"));
      for (const attDoc of attendanceSnapshot.docs) { if (attDoc.id.startsWith(tradeCode + "_")) { await deleteDoc(doc(db, "attendance", attDoc.id)); } }
      window.closePopup(); await window.loadTrades(); alert('Trade & related data removed.');
    };
    window.addTrade = async function() {
      const tradeName = document.getElementById("newTradeName").value.trim();
      const tradeCode = document.getElementById("newTradeCode").value.trim().toUpperCase();
      if (!tradeName || !tradeCode) return alert('Please fill all fields');
      await setDoc(doc(collection(db, "trades"), tradeCode), { name: tradeName, code: tradeCode });
      window.closePopup(); await window.loadTrades(); alert('Trade added');
    };
    window.addStudent = async function() {
      const tradeCode = document.getElementById("studentTrade").value;
      const studentName = document.getElementById("newStudentName").value.trim();
      const studentYear = document.getElementById("newStudentYear").value;
      const studentMobile = document.getElementById("newStudentMobile").value.trim();
      const studentAdmission = document.getElementById("newStudentAdmission").value.trim();
      const studentShift = document.getElementById("newStudentShift").value;
      const studentUnit = document.getElementById("newStudentUnit").value.trim();
      if (!tradeCode || !studentName || !studentMobile || !studentAdmission || !studentShift || !studentUnit || !studentYear) return alert('Please fill all required fields');
      await setDoc(doc(collection(db, "students")), {
        tradeCode, name: studentName, year: studentYear, mobile: studentMobile, admission: studentAdmission, shift: studentShift, unit: studentUnit });
      window.closePopup(); await window.showStudentsList(); alert('Student added');
    };
    window.loadTrades = async function() {
      const tradeSelector = document.getElementById('tradeSelector');
      const studentTrade = document.getElementById('studentTrade');
      const recordsTradeSelector = document.getElementById('recordsTradeSelector');
      [tradeSelector, studentTrade, recordsTradeSelector].forEach(sel => { if (!sel) return;
        while (sel.options && sel.options.length > 1) sel.remove(1); });
      const tradesSnapshot = await getDocs(collection(db, 'trades'));
      tradesSnapshot.forEach(docSnap => {
        const trade = docSnap.data();
        addOption(tradeSelector, trade.code, `${trade.name} (${trade.code})`);
        addOption(studentTrade, trade.code, `${trade.name} (${trade.code})`);
        addOption(recordsTradeSelector, trade.code, `${trade.name} (${trade.code})`);
      });
    };
    function addOption(select, value, text) {
      if (!select) return;
      const opt = document.createElement("option"); opt.value = value; opt.textContent = text; select.appendChild(opt);
    }
    window.showStudentsList = async function() {
      const tradeCode = document.getElementById("tradeSelector").value;
      const studentsList = document.getElementById("studentsList");
      studentsList.innerHTML = "";
      let students = [];
      if (!tradeCode) {
        const studentsSnapshot = await getDocs(collection(db, 'students'));
        studentsSnapshot.forEach(docSnap => students.push({ id: docSnap.id, ...docSnap.data() }));
        const attendanceSnapshot = await getDocs(collection(db, "attendance"));
        const today = getToday();
        const attendanceMap = {};
        attendanceSnapshot.forEach(docSnap => { if (docSnap.id.endsWith("_" + today)) {
          const trade = docSnap.id.split("_")[0]; attendanceMap[trade] = docSnap.data().data || [];
        } });
        students.forEach(student => {
          const arr = attendanceMap[student.tradeCode] || [];
          student.status = arr.length ? arr[students.indexOf(student)] || "" : "";
        });
        updateSummary(students.map(s => s.status));
        studentsList.innerHTML = "<li>Select a trade to view students.</li>";
        return;
      }
      const studentsQuery = query(collection(db, 'students'), where('tradeCode', '==', tradeCode));
      const studentsSnapshot = await getDocs(studentsQuery);
      studentsSnapshot.forEach(docSnap => students.push({ id: docSnap.id, ...docSnap.data() }));
      const attendanceDoc = await getDoc(doc(db, "attendance", `${tradeCode}_${getToday()}`));
      const attendance = attendanceDoc.exists() ? attendanceDoc.data().data : [];
      for (let i = 0; i < students.length; i++) {
        const student = students[i];
        const item = document.createElement("li");
        item.className = "student-item";
        if (attendance[i]) item.classList.add(attendance[i]);
        item.innerHTML = `
          <div class="student-info">
            <div class="student-name">${student.name}</div>
            <div class="student-details">
              Year: ${student.year}, Mobile: ${student.mobile}, Admission: ${student.admission}, Shift: ${student.shift}, Unit: ${student.unit}
            </div>
          </div>
          <div class="attendance-buttons">
            <button class="attendance-btn btn-present" onclick="window.markAttendance('${tradeCode}',${i},'present')">P</button>
            <button class="attendance-btn btn-absent" onclick="window.markAttendance('${tradeCode}',${i},'absent')">A</button>
            <button class="attendance-btn btn-leave" onclick="window.markAttendance('${tradeCode}',${i},'leave')">L</button>
            <button class="attendance-btn btn-delete" style="background:#e74c3c;color:white;margin-left:10px;" onclick="window.removeStudent('${student.id}')">Delete</button>
          </div>
        `;
        studentsList.appendChild(item);
      }
      updateSummary(attendance);
    };
    window.markAttendance = async function(tradeCode, idx, status) {
      const today = getToday();
      const attendanceRef = doc(db, "attendance", `${tradeCode}_${today}`);
      const attendanceDoc = await getDoc(attendanceRef);
      let attendance = attendanceDoc.exists() ? attendanceDoc.data().data : [];
      attendance[idx] = status;
      await setDoc(attendanceRef, { data: attendance });
      await window.showStudentsList();
    };
    window.removeStudent = async function(studentId) {
      if (!confirm("Are you sure you want to delete this student?")) return;
      await deleteDoc(doc(db, "students", studentId));
      await window.showStudentsList();
    };
    window.submitAttendance = async function() {
      const tradeCode = document.getElementById("tradeSelector").value;
      const today = getToday();
      const items = Array.from(document.querySelectorAll("#studentsList .student-item"));
      const attendance = items.map(item =>
        item.classList.contains("present")
          ? "present"
          : item.classList.contains("absent")
          ? "absent"
          : item.classList.contains("leave")
          ? "leave"
          : ""
      );
      await setDoc(doc(db, "attendance", `${tradeCode}_${today}`), { data: attendance });
      alert("Attendance submitted!");
      await window.showStudentsList();
    };
    function updateSummary(attendanceArr) {
      document.getElementById("totalStudents").textContent = attendanceArr.length;
      document.getElementById("totalPresent").textContent = attendanceArr.filter(x => x === "present").length;
      document.getElementById("totalAbsent").textContent = attendanceArr.filter(x => x === "absent").length;
      document.getElementById("totalLeave").textContent = attendanceArr.filter(x => x === "leave").length;
    }
    window.showRecords = async function() {
      const tradeCode = document.getElementById('recordsTradeSelector').value;
      const rawDate = document.getElementById('recordsDateSelector').value;
      const date = toIsoDate(rawDate);
      let students = [];
      if (!tradeCode) {
        const studentsSnapshot = await getDocs(collection(db, 'students'));
        studentsSnapshot.forEach(docSnap => students.push({ id: docSnap.id, ...docSnap.data() }));
        const attendanceSnapshot = await getDocs(collection(db, 'attendance'));
        const attendanceMap = {};
        attendanceSnapshot.forEach(docSnap => {
          if (docSnap.id.endsWith('_' + date)) {
            const trade = docSnap.id.split('_')[0];
            attendanceMap[trade] = docSnap.data().data || [];
          }
        });
        students.forEach(student => {
          const attendanceForTrade = attendanceMap[student.tradeCode] || [];
          student.status = attendanceForTrade.length > 0 ? attendanceForTrade[students.indexOf(student)] || "" : "";
        });
      } else {
        const studentsQuery = query(collection(db, 'students'), where('tradeCode', '==', tradeCode));
        const studentsSnapshot = await getDocs(studentsQuery);
        studentsSnapshot.forEach(docSnap => students.push({ id: docSnap.id, ...docSnap.data() }));
        const attendanceDoc = await getDoc(doc(db, "attendance", `${tradeCode}_${date}`));
        const attendance = attendanceDoc.exists() ? attendanceDoc.data().data : [];
        for (let i = 0; i < students.length; i++) {
          students[i].status = attendance[i] || "";
        }
      }
      let present = students.filter(s => s.status === "present");
      let absent = students.filter(s => s.status === "absent");
      let leave = students.filter(s => s.status === "leave");
      window.lastReportData = {present, absent, leave};
      function makeTable(list, statusLabel) {
        if (list.length === 0) return `<strong>${statusLabel}</strong><br><em>No students</em><br>`;
        let html = `<strong>${statusLabel}</strong><table border="1" cellspacing="0" cellpadding="4" style="margin-bottom:18px;">
          <tr style="background:#eee;">
            <th>Trade</th> <th>Name</th> <th>Mobile</th> <th>Admission Date</th> <th>Shift</th> <th>Unit</th> <th>Status</th>
          </tr>`;
        list.forEach(stu => {
          html += `<tr>
            <td>${stu.tradeCode}</td> <td>${stu.name}</td> <td>${stu.mobile}</td> <td>${stu.admission}</td>
            <td>${stu.shift}</td> <td>${stu.unit}</td> <td>${statusLabel}</td>
          </tr>`;
        });
        html += `</table>`;
        return html;
      }
      document.getElementById('recordsTable').innerHTML =
        makeTable(present, "Present") +
        makeTable(absent, "Absent") +
        makeTable(leave, "Leave");
    };
    window.downloadPdf = function(status) {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const data = window.lastReportData || {present:[], absent:[], leave:[]};
      const listData = data[status] || [];
      if (listData.length === 0) { alert(`No ${status} records to export`); return; }
      const columns = [
        { header: 'Trade', dataKey: 'tradeCode' },
        { header: 'Name', dataKey: 'name' },
        { header: 'Mobile', dataKey: 'mobile' },
        { header: 'Admission Date', dataKey: 'admission' },
        { header: 'Shift', dataKey: 'shift' },
        { header: 'Unit', dataKey: 'unit' },
        { header: 'Status', dataKey: 'status' },
      ];
      doc.text(`${status.charAt(0).toUpperCase() + status.slice(1)} Attendance Report`, 14, 15);
      doc.autoTable({
        startY: 20,
        head: [columns.map(col => col.header)],
        body: listData.map(row => columns.map(col => row[col.dataKey])),
        theme: 'striped'
      });
      doc.save(`${status}_attendance_report.pdf`);
    };

    loginBtn.onclick = async () => {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value.trim();
      try { await signInWithEmailAndPassword(auth, email, password); loginError.style.display = 'none'; }
      catch (err) { loginError.style.display = 'block'; loginError.textContent = err.message; }
    };
    logoutBtn.onclick = () => { signOut(auth); };
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        loginContainer.style.display = 'none'; appContainer.style.display = 'block';
        logoutBtn.style.display = 'inline-block';
        document.querySelector('.navbar').style.display = 'flex';
        document.getElementById('currentDate').textContent = new Date().toLocaleDateString('en-IN');
        await window.loadTrades(); await window.showStudentsList();
      } else {
        loginContainer.style.display = 'flex'; appContainer.style.display = 'none';
        logoutBtn.style.display = 'none'; document.querySelector('.navbar').style.display = 'none';
      }
    });
  </script>
</body>
</html>
